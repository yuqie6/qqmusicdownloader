[æ ¹ç›®å½•](../../CLAUDE.md) > **tests**

# æµ‹è¯•æ¨¡å—

## æ¨¡å—èŒè´£

æä¾› QQ éŸ³ä¹ä¸‹è½½å™¨çš„æµ‹è¯•å¥—ä»¶ï¼Œç¡®ä¿æ ¸å¿ƒåŠŸèƒ½çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚ç›®å‰ä»¥åŸºç¡€æµ‹è¯•æ¡†æ¶ä¸ºä¸»ï¼Œéœ€è¦è¿›ä¸€æ­¥æ‰©å±•æµ‹è¯•è¦†ç›–ã€‚

## å…¥å£ä¸å¯åŠ¨

### ä¸»å…¥å£ï¼š`test_app.py`
- **æµ‹è¯•æ¡†æ¶**ï¼špytest
- **è¿è¡Œå‘½ä»¤**ï¼š`pytest tests/`
- **è¦†ç›–ç‡**ï¼šåŸºç¡€æ¡†æ¶å·²å»ºç«‹

### å¯åŠ¨å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_app.py

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src/qq_music_downloader tests/
```

## å¯¹å¤–æ¥å£

### æµ‹è¯•ç±»å’Œå‡½æ•°
- `test_first()` - åŸºç¡€æµ‹è¯•ç¤ºä¾‹
- `qq_music_downloader.py` - é›†æˆæµ‹è¯•æ–‡ä»¶
- `__init__.py` - æµ‹è¯•åŒ…åˆå§‹åŒ–

### æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… åŸºç¡€æµ‹è¯•æ¡†æ¶
- âŒ API æ¥å£æµ‹è¯• (å¾…è¡¥å……)
- âŒ ä¸‹è½½åŠŸèƒ½æµ‹è¯• (å¾…è¡¥å……)
- âŒ UI äº¤äº’æµ‹è¯• (å¾…è¡¥å……)
- âŒ åŠ å¯†è§£å¯†æµ‹è¯• (å¾…è¡¥å……)

## å…³é”®ä¾èµ–ä¸é…ç½®

### æµ‹è¯•ä¾èµ–
```python
# pyproject.toml
dependencies = [
    "pytest>=8.4.2",
    # å…¶ä»–ä¾èµ–...
]
```

### æµ‹è¯•é…ç½®
- ä½¿ç”¨ pytest æ ‡å‡†é…ç½®
- å»ºè®®æ·»åŠ è¦†ç›–ç‡æ£€æŸ¥
- å»ºè®®æ·»åŠ  CI/CD é›†æˆ

## æ•°æ®æ¨¡å‹

### æµ‹è¯•æ•°æ®
- æ¨¡æ‹Ÿ Cookie æ•°æ®
- æµ‹è¯•æ­Œæ›²ä¿¡æ¯
- API å“åº”æ ·æœ¬

### Mock å¯¹è±¡
- HTTP è¯·æ±‚æ¨¡æ‹Ÿ
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ¨¡æ‹Ÿ
- Node.js è¿›ç¨‹æ¨¡æ‹Ÿ

## æµ‹è¯•ä¸è´¨é‡

### å½“å‰æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•**ï¼šåŸºç¡€æ¡†æ¶
- **é›†æˆæµ‹è¯•**ï¼šAPI æ¥å£æµ‹è¯• (å¾…å¼€å‘)
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šå®Œæ•´ä¸‹è½½æµç¨‹æµ‹è¯• (å¾…å¼€å‘)

### å»ºè®®æ‰©å±•
```python
# å»ºè®®æ·»åŠ çš„æµ‹è¯•
class TestQQMusicAPI:
    def test_cookie_validation(self):
        """æµ‹è¯• Cookie éªŒè¯åŠŸèƒ½"""
        pass

    def test_song_search(self):
        """æµ‹è¯•æ­Œæ›²æœç´¢åŠŸèƒ½"""
        pass

    def test_download_url_generation(self):
        """æµ‹è¯•ä¸‹è½½é“¾æ¥ç”Ÿæˆ"""
        pass

class TestQQMusicApp:
    def test_ui_initialization(self):
        """æµ‹è¯• TUI ç•Œé¢åˆå§‹åŒ–"""
        pass
```

## å¸¸è§é—®é¢˜ (FAQ)

### Q: å¦‚ä½•è¿è¡Œæµ‹è¯•ï¼Ÿ
A: ä½¿ç”¨ `pytest tests/` å‘½ä»¤è¿è¡Œæ‰€æœ‰æµ‹è¯•ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°æµ‹è¯•ï¼Ÿ
A: åœ¨ `tests/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶ï¼Œä»¥ `test_` å¼€å¤´ã€‚

### Q: å¦‚ä½•ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼Ÿ
A: ä½¿ç”¨ `pytest --cov=src/qq_music_downloader tests/`ã€‚

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æµ‹è¯•æ–‡ä»¶
- `test_app.py` - åº”ç”¨åŸºç¡€æµ‹è¯• (4è¡Œ)
- `qq_music_downloader.py` - é›†æˆæµ‹è¯•æ–‡ä»¶
- `__init__.py` - æµ‹è¯•åŒ…åˆå§‹åŒ–

### é…ç½®æ–‡ä»¶
- `pytest.ini` - pytest é…ç½® (å»ºè®®æ·»åŠ )
- `.coveragerc` - è¦†ç›–ç‡é…ç½® (å»ºè®®æ·»åŠ )

## æµ‹è¯•ç¼ºå£ä¸å»ºè®®

### æ€¥éœ€è¡¥å……çš„æµ‹è¯•
1. **API æ¥å£æµ‹è¯•**
   - Cookie éªŒè¯é€»è¾‘
   - æ­Œæ›²æœç´¢åŠŸèƒ½
   - ä¸‹è½½é“¾æ¥ç”Ÿæˆ

2. **æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**
   - åŠ å¯†è§£å¯†ç®—æ³•
   - æ–‡ä»¶ä¸‹è½½æµç¨‹
   - é”™è¯¯å¤„ç†æœºåˆ¶

3. **UI äº¤äº’æµ‹è¯•**
   - TUI ç•Œé¢å“åº”
   - ç”¨æˆ·è¾“å…¥å¤„ç†
   - çŠ¶æ€ç®¡ç†

### å»ºè®®çš„æµ‹è¯•ç»“æ„
```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ test_api.py
â”‚   â”œâ”€â”€ test_downloader.py
â”‚   â””â”€â”€ test_crypto.py
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ test_download_flow.py
â”‚   â””â”€â”€ test_ui_flow.py
â”œâ”€â”€ fixtures/
â”‚   â”œâ”€â”€ sample_responses.json
â”‚   â””â”€â”€ mock_cookies.txt
â””â”€â”€ conftest.py
```

## å˜æ›´è®°å½• (Changelog)

### 2025-10-02
- ğŸ†• åˆ›å»ºæµ‹è¯•æ¨¡å—æ–‡æ¡£
- ğŸ“Š åˆ†æå½“å‰æµ‹è¯•è¦†ç›–ç‡
- ğŸ“ åˆ¶å®šæµ‹è¯•æ‰©å±•è®¡åˆ’

---

*æœ€åæ›´æ–°ï¼š2025-10-02*